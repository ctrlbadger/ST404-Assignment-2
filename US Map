
```{r, include=FALSE}
library(dplyr)
library(ggplot2)
library(tidyr)
library(maps)
load('cancer.rdata')
cancer <- filter(cancer, incidenceRate <= 1100)
cancermodel2 = separate(cancer,"Geography", into=c("County","State"),sep=",")[-c(1,4,5,16)]

```




```{r, include=FALSE}
#average for each state
averagedeathrate=round(tapply(cancermodel2$deathRate,cancermodel2$State,mean)[-c(2,12)],0)

states <- map_data("state")

averagedf <- data.frame(region=unique(states$region), averagedeathrate)

mergedf <- merge(states, averagedf, by="region")

statenames <- data.frame(region=tolower(state.name), clong=state.center$x, clat=state.center$y)

statenames <- merge(statenames, averagedf, by="region")
```



```{R USMAP, echo=FALSE}
qplot(long, lat, data=mergedf, geom="polygon", fill=averagedeathrate, group=group) + scale_fill_gradient(averagedeathrate,low="yellow",high="red") + geom_text(data=statenames,aes(clong,clat,label=averagedeathrate),inherit.aes = FALSE,size=3)+ theme(axis.line=element_blank(),axis.text.x=element_blank(),
                                                                                                                                                                                                                                                         axis.text.y=element_blank(),axis.ticks=element_blank(),
                                                                                                                                                                                                                                                         axis.title.x=element_blank(),
                                                                                                                                                                                                                                                         axis.title.y=element_blank(), legend.title = element_blank(),
                                                                                                                                                                                                                                                         panel.background=element_blank(),panel.border=element_blank(),panel.grid.major=element_blank(),
                                                                                                                                                                                                                                                         panel.grid.minor=element_blank(),plot.background=element_blank(),plot.title =element_text(hjust=0.5) ) + ggtitle("Heatmap of Death Rates of US States") 

```
