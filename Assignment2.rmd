---
title: "ST404 Assignment 2"
author: "Frank Or, Remos Gong, Sam Glanfield, Thomas Broadbent"
date: "`r Sys.Date()`"
output:
  bookdown::pdf_document2: default
  pdf_document: 
    number_sections: true
fontsize: 11pt
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(bookdown)
library(knitr)
```

```{r libraries, include=FALSE}
library(dplyr)

```

\pagebreak 

# Findings

# Statistical Methodology

```{r loadData, include=FALSE}
## Included Libraries
# For pipe operator and general mutation
load('cancer.rdata')

```

We first combined our results and findings from our preliminary EDA which is mainly discussed in [Outliers](#outliers) and [Transformations](#transformations).

## Outliers {#outliers}

Counties with high Incidence Rates, namely 'Union County, Florida' and 'Williamsburg City, Virginia' were removed from the model building process as they had high influence over the model and were not reflective of the rest of the data.

```{r incidenceRateRemoval, include=FALSE}
# Removing outlier incidence rates 'Union County, Florida' and 'Williamsburg City, Virginia'
cancer <- filter(cancer, incidenceRate <= 700)

```

For counties with Average Household Size less than one we took the decision to scale the transformations by 100 and keep them in the dataset. 

```{r averageHouseholdSize, include=FALSE}
# Scale average household sizes that are less than 1 by 100
cancer[which(cancer$AvgHouseholdSize < 1), ]$AvgHouseholdSize <- 
  100*cancer[which(cancer$AvgHouseholdSize < 1), ]$AvgHouseholdSize

```

We also see counties with missing values in Percentage Employed 16 and Over and we conclude that the data is Missing Completely at Random. In order to rectify this we impute this data by fitting a linear regression model of Percentage Employed 16 and Over on the remaining variables to estimate what these values would be.

```{r impute, include=FALSE}
# Impute the missing data seen in the dataset
mod1=lm(PctEmployed16_Over~+deathRate+incidenceRate+medIncome+binnedInc+povertyPercent+MedianAgeMale+MedianAgeFemale+AvgHouseholdSize+PercentMarried+PctUnemployed16_Over+PctPrivateCoverage+PctEmpPrivCoverage+PctPublicCoverage+PctBlack+PctMarriedHouseholds+Edu18_24,cancer)
missdf = cancer[which(is.na(cancer$PctEmployed16_Over)==TRUE),]
imputed = predict(mod1,missdf)
cancer[which(is.na(cancer$PctEmployed16_Over)==TRUE),"PctEmployed16_Over"] = imputed

```


## Transformations {#transformations}

We transform Percent Black by first shifting the values upwards by 0.05, to ensure we have no zero values, then take a log transform. We also transform the Median Income by again taking a log trasformation. We do these transformations to ensure the data is not heavily skewed and allow for a more accurate model.

```{r transformations, include=FALSE}
# Log transforming the heavily skewed distributions of PctBlack and medIncome
cancer$logpctblack = log(cancer$PctBlack+0.05)
cancer$logmedincome = log(cancer$medIncome)

```

## Modelling Approach and Variable Selection

### AIC Forward and Backward Variable Selection

We perform forward, backward and hybrid stepwise regression according to both AIC and BIC. We see that the models generated for AIC are all the same and ones generated for BIC are al the same. In the AIC case we have the model has 14 parameters, whereas the BIC model has 11 variables. 

```{r stepwise}
# Below we perform stepwise regression for both AIC and BIC
cancermodel = cancer[,-c(1,2,4,16)]
c0=lm(deathRate~1)
cmax=lm(deathRate~.,cancermodel)
forwardoptimalAIC = step(c0,direction="forward",scope=list("lower"=c0,"upper"=cmax),trace=0)
backwardoptimalAIC = step(cmax,direction="backward",scope=list("lower"=c0,"upper"=cmax),trace=0)
hybridoptimalAIC = step(c0,direction="both",scope=list("lower"=c0,"upper"=cmax),trace=0)
forwardoptimalBIC = step(c0,direction="forward",scope=list("lower"=c0,"upper"=cmax),trace=0,k=log(3044))
backwardoptimalBIC = step(cmax,direction="backward",scope=list("lower"=c0,"upper"=cmax),trace=0,k=log(3044))
hybridoptimalBIC = step(c0,direction="both",scope=list("lower"=c0,"upper"=cmax),trace=0,k=log(3044))

```

### RIDGE Regression

## Statistical Interpretation and Validation

# References 

<div id="refs"></div>

# Appendix

```{r get-labels, echo = FALSE}
labs = all_labels()
labs = setdiff(labs, c("setup", "get-labels"))
```

```{r all-code, ref.label=labs, eval=FALSE}
```
  
